## Wallet Manager Hyperty

The Wallet Manager hyperty handles Token Wallets on behalf of a user.

### Configuration:

* `observers`: array with all vertx hyperty observers to be invited for all wallets.

### Storage

Each wallet is store as a JSON object:

```
{
  address: <wallet address>,
  identity: <wallet owner identity>,
  created: <timestamp creation>,
  balance: <amount of token>,
  transactions: <JSON OBject. see below>,
  status: <active,deleted>
}
```

Transaction JSON Object:
```
{
  recipient: <wallet address of the recipient>,
  source: <data stream address>,
  date: <ISO 8601 compliant>,
  value: <amount of tokens in the transaction>
  nonce: < the count of the number of performed mining transactions, starting with 0>
}
```

### Wallet creation requests

**handler:** wallet manager address.

**message:**

```
type: create,
identity: <compliant with reTHINK identity model>,
from: <wallet observer hyperty address>
```

Before the wallet is created, it checks there is no wallet yet for the identity. The Wallet Address is generated by using some crypto function that uses the identity GUID as seed and returned.

A new entry is created in the Wallet Manager store.

An invitation is sent to `config.observers`.

### Wallet address request

**handler:** wallet manager address.

**message:**

```
type: read,
body: { resource: 'user', value: <userId>}
```

### Wallet transfer

**handler:** wallet manager address.

**message:**

```
type: create,
body: { resource: 'wallet/<wallet-address>', value: <transaction JSON Object>}
```

If valid, the transaction is stored and the balance updated.

The transaction is published in the event bus using the wallet address.

### Wallet read

**handler:** wallet address.

**message:**

```
type: read,
```

Returns the stored Wallet value.

### Wallet delete requests

**handler:** wallet manager address.

**message:**

```
type: delete,
identity: <compliant with reTHINK identity model>,
from: <wallet observer hyperty address>
```

It checks there is wallet for the identity and deletes from the storage.

A delete info message is sent to `config.observers`.
